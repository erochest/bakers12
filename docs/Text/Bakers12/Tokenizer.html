<!DOCTYPE html>  <html> <head>   <title>Tokenizer.hs</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               Tokenizer.hs             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>This implements the tokenizer. It returns all tokens, without throwing any
text away. That way, the unprocessed token stream can be used to re-create
the input.</p>

<p>The processing uses the
<a href="http://hackage.haskell.org/package/enumerator">enumerator</a> library to
produce a stream of tokens from a stream of input or to convert an input
stream into a stream of <code>Token</code> instances.</p>

<p>The <code>tokenize</code> and <code>tokenizeFile</code> functions hide this by accumulating the
output tokens into a list and returning that.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kr">module</span> <span class="nn">Text.Bakers12.Tokenizer</span>
    <span class="p">(</span> <span class="kt">Token</span><span class="p">(</span><span class="o">..</span><span class="p">)</span>
    <span class="p">,</span> <span class="kt">TokenType</span><span class="p">(</span><span class="o">..</span><span class="p">)</span>
    <span class="p">,</span> <span class="nf">tokenize</span>
    <span class="p">,</span> <span class="nf">tokenizeFile</span>
    <span class="p">,</span> <span class="nf">tokenizeFileStream</span>
    <span class="p">,</span> <span class="nf">tokenizeStream</span>
    <span class="p">,</span> <span class="nf">tokenizeE</span>
    <span class="p">)</span> <span class="kr">where</span>

<span class="kr">import</span>           <span class="nn">Control.Exception</span> <span class="p">(</span><span class="kt">SomeException</span><span class="p">)</span>
<span class="kr">import</span>           <span class="nn">Control.Monad</span> <span class="p">(</span><span class="nf">liftM</span><span class="p">)</span>
<span class="kr">import</span>           <span class="nn">Control.Monad.Trans</span> <span class="p">(</span><span class="nf">lift</span><span class="p">)</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Char</span> <span class="k">as</span> <span class="n">C</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Enumerator</span> <span class="k">as</span> <span class="n">E</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Enumerator.Binary</span> <span class="k">as</span> <span class="n">EB</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Enumerator.List</span> <span class="k">as</span> <span class="n">EL</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Enumerator.Text</span> <span class="k">as</span> <span class="n">ET</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Text</span> <span class="k">as</span> <span class="n">T</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Text.Lazy</span> <span class="k">as</span> <span class="n">LT</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p><a href="Tokenizer/Types.html">Text.Bakers12.Tokenizer.Types</a><br /></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kr">import</span>           <span class="nn">Text.Bakers12.Tokenizer.Types</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>This reads text from an instance of Data.Text.Text and returns a list of
Token instances.</p>

<p><code>Either SomeException</code> is a standard way to define a computation that may
return something (in this case, a list of tokens) or may have an error.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nf">tokenize</span> <span class="ow">::</span> <span class="kt">FilePath</span> <span class="ow">-&gt;</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Text</span> <span class="ow">-&gt;</span> <span class="kt">Either</span> <span class="kt">SomeException</span> <span class="p">[</span><span class="kt">Token</span><span class="p">]</span>
<span class="nf">tokenize</span> <span class="n">source</span> <span class="n">input</span> <span class="ow">=</span>
    <span class="kt">E</span><span class="o">.</span><span class="n">runLists</span> <span class="p">[[</span><span class="n">input</span><span class="p">]]</span> <span class="p">(</span><span class="n">tokenizeStream</span> <span class="n">source</span> <span class="mi">0</span> <span class="kt">E</span><span class="o">.=$</span> <span class="kt">EL</span><span class="o">.</span><span class="n">consume</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>This reads the input from a file and returns a list of Token instances.</p>

<p>Because this has to read from the file system, it has to execute in the
context of the <code>IO</code> monad. Otherwise, this is the same as <code>tokenize</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nf">tokenizeFile</span> <span class="ow">::</span> <span class="kt">FilePath</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="p">(</span><span class="kt">Either</span> <span class="kt">SomeException</span> <span class="p">[</span><span class="kt">Token</span><span class="p">])</span>
<span class="nf">tokenizeFile</span> <span class="n">inputFile</span> <span class="ow">=</span>
    <span class="kt">E</span><span class="o">.</span><span class="n">run</span> <span class="p">(</span><span class="n">tokenizeFileStream</span> <span class="n">inputFile</span> <span class="kt">E</span><span class="o">.$$</span> <span class="kt">EL</span><span class="o">.</span><span class="n">consume</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>This creates an <code>Enumerator</code> that reads from a file and produces <code>Token</code>
instances.</p>

<p>Enumerators produce data for an enumerator processing pipeline.</p>

<p>This assumes that the files are UTF8.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nf">tokenizeFileStream</span> <span class="ow">::</span> <span class="kt">FilePath</span> <span class="ow">-&gt;</span> <span class="kt">E</span><span class="o">.</span><span class="kt">Enumerator</span> <span class="kt">Token</span> <span class="kt">IO</span> <span class="n">b</span>
<span class="nf">tokenizeFileStream</span> <span class="n">inputFile</span> <span class="ow">=</span>
    <span class="kt">EB</span><span class="o">.</span><span class="n">enumFile</span> <span class="n">inputFile</span> <span class="kt">E</span><span class="o">.$=</span>
    <span class="kt">ET</span><span class="o">.</span><span class="n">decode</span> <span class="kt">ET</span><span class="o">.</span><span class="n">utf8</span> <span class="kt">E</span><span class="o">.$=</span>
    <span class="n">tokenizeStream</span> <span class="n">inputFile</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>This is an <code>Enumeratee</code> that takes <code>FilePath</code> and returns a <code>Enumerator</code> of
<code>Token</code> instances.</p>

<p><code>Enumeratees</code> are links in the pipeline between an <code>Enumerator</code> and an
<code>Iteratee</code>. They take input coming in and filter or transform it and pass it
on. Because they're in the middle, they have to pay more attention to the
enumerator API. I'll take some time to explain how that works as we
encounter it.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nf">tokenizeE</span> <span class="ow">::</span> <span class="kt">E</span><span class="o">.</span><span class="kt">Enumeratee</span> <span class="kt">FilePath</span> <span class="kt">Token</span> <span class="kt">IO</span> <span class="n">b</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>First, one of the values that an enumeratee can accept is a continuation.
This means that there is another chunk of data available.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nf">tokenizeE</span> <span class="n">cont</span><span class="o">@</span><span class="p">(</span><span class="kt">E</span><span class="o">.</span><span class="kt">Continue</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="kr">do</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>This returns the first item waiting on the input stream. <code>Continue</code>
means that there is more data to come, but we may not have it right now
(say for networking).  So <code>EL.head</code> may return data, or it may not. In
Haskell, this means a <code>Maybe</code> data type.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">maybeFP</span> <span class="ow">&lt;-</span> <span class="kt">EL</span><span class="o">.</span><span class="n">head</span>
    <span class="kr">case</span> <span class="n">maybeFP</span> <span class="kr">of</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>If there is data right now, it's a file path. We just pass it to
<code>tokenizeFileStream</code>, which returns a bunch of tokens, and then
loop.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kt">Just</span> <span class="n">filePath</span> <span class="ow">-&gt;</span> <span class="n">tokenizeFileStream</span> <span class="n">filePath</span> <span class="n">cont</span> <span class="kt">E</span><span class="o">.&gt;&gt;==</span> <span class="n">tokenizeE</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>If there is no data at the moment, just continue waiting.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kt">Nothing</span>       <span class="ow">-&gt;</span> <span class="n">return</span> <span class="n">cont</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Other enumeratee inputs mean other things (no more data, end of stream,
etc.), but we don't care about that.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nf">tokenizeE</span> <span class="n">step</span> <span class="ow">=</span> <span class="n">return</span> <span class="n">step</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p><em>(After explaining this, there's an obvious way to cut down on the
boilerplate for this, at least for this application. It won't happen today,
however.)</em></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>This is an Enumeratee that takes a stream of Char and transforms it into a
stream of Token.</p>

<p><code>FilePath</code> and <code>Integer</code> are the current state of the tokenizer. This should
probably be wrapped in a <code>State</code> monad and stacked on top of this, but for
the moment, this is simpler.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nf">tokenizeStream</span> <span class="ow">::</span> <span class="kt">Monad</span> <span class="n">m</span> <span class="ow">=&gt;</span>
                  <span class="kt">FilePath</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">E</span><span class="o">.</span><span class="kt">Enumeratee</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Text</span> <span class="kt">Token</span> <span class="n">m</span> <span class="n">b</span>
<span class="nf">tokenizeStream</span> <span class="n">source</span> <span class="n">offset</span> <span class="n">cont</span><span class="o">@</span><span class="p">(</span><span class="kt">E</span><span class="o">.</span><span class="kt">Continue</span> <span class="n">k</span><span class="p">)</span> <span class="ow">=</span> <span class="kr">do</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>This looks at the first character from the input ...</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">maybeC</span> <span class="ow">&lt;-</span> <span class="kt">ET</span><span class="o">.</span><span class="n">head</span>
    <span class="kr">case</span> <span class="n">maybeC</span> <span class="kr">of</span>
        <span class="kt">Just</span> <span class="n">c</span>  <span class="ow">-&gt;</span> <span class="kr">do</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>... and dispatches to <code>tokenize'</code> based on the first character.
It passes the token into the output stream and loops to take
care of the next token.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="n">token</span> <span class="ow">&lt;-</span> <span class="n">tokenize&#39;</span> <span class="n">source</span> <span class="n">offset</span> <span class="n">c</span>
            <span class="n">next</span>  <span class="ow">&lt;-</span> <span class="n">lift</span> <span class="o">$</span> <span class="kt">E</span><span class="o">.</span><span class="n">runIteratee</span> <span class="o">$</span> <span class="n">k</span> <span class="o">$</span> <span class="kt">E</span><span class="o">.</span><span class="kt">Chunks</span> <span class="p">[</span><span class="n">token</span><span class="p">]</span>
            <span class="n">tokenizeStream</span> <span class="n">source</span> <span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">fromIntegral</span> <span class="p">(</span><span class="n">tokenLength</span> <span class="n">token</span><span class="p">))</span> <span class="n">next</span>
        <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="n">return</span> <span class="n">cont</span>
<span class="nf">tokenizeStream</span> <span class="kr">_</span> <span class="kr">_</span> <span class="n">step</span> <span class="ow">=</span> <span class="n">return</span> <span class="n">step</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>This takes a character and dispatches the handle the tokenizing the rest
of the token from it.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nf">tokenize&#39;</span> <span class="ow">::</span> <span class="kt">Monad</span> <span class="n">m</span> <span class="ow">=&gt;</span> <span class="kt">FilePath</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Char</span> <span class="ow">-&gt;</span> <span class="kt">E</span><span class="o">.</span><span class="kt">Iteratee</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Text</span> <span class="n">m</span> <span class="kt">Token</span>
<span class="nf">tokenize&#39;</span> <span class="n">source</span> <span class="n">offset</span> <span class="n">c</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Tokens that contain alphanumeric or spaces/separators return a span of
tokens of the same type.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="o">|</span> <span class="kt">C</span><span class="o">.</span><span class="n">isAlpha</span> <span class="n">c</span>       <span class="ow">=</span> <span class="n">tokenFromTaken</span> <span class="n">source</span> <span class="n">offset</span> <span class="kt">AlphaToken</span> <span class="n">c</span> <span class="kt">C</span><span class="o">.</span><span class="n">isAlpha</span>
    <span class="o">|</span> <span class="kt">C</span><span class="o">.</span><span class="n">isNumber</span> <span class="n">c</span>      <span class="ow">=</span> <span class="n">tokenFromTaken</span> <span class="n">source</span> <span class="n">offset</span> <span class="kt">NumberToken</span> <span class="n">c</span> <span class="kt">C</span><span class="o">.</span><span class="n">isNumber</span>
    <span class="o">|</span> <span class="n">isSeparator</span> <span class="n">c</span>     <span class="ow">=</span> <span class="n">tokenFromTaken</span> <span class="n">source</span> <span class="n">offset</span> <span class="kt">SeparatorToken</span> <span class="n">c</span> <span class="n">isSeparator</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Punctuation, symbols, marks, and what-have-yous are single-character
tokens.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="o">|</span> <span class="kt">C</span><span class="o">.</span><span class="n">isPunctuation</span> <span class="n">c</span> <span class="ow">=</span> <span class="n">return</span> <span class="o">.</span> <span class="n">makeToken</span> <span class="n">source</span> <span class="n">offset</span> <span class="kt">PunctuationToken</span> <span class="o">$</span> <span class="kt">T</span><span class="o">.</span><span class="n">singleton</span> <span class="n">c</span>
    <span class="o">|</span> <span class="kt">C</span><span class="o">.</span><span class="n">isSymbol</span> <span class="n">c</span>      <span class="ow">=</span> <span class="n">return</span> <span class="o">.</span> <span class="n">makeToken</span> <span class="n">source</span> <span class="n">offset</span> <span class="kt">SymbolToken</span> <span class="o">$</span> <span class="kt">T</span><span class="o">.</span><span class="n">singleton</span> <span class="n">c</span>
    <span class="o">|</span> <span class="kt">C</span><span class="o">.</span><span class="n">isMark</span> <span class="n">c</span>        <span class="ow">=</span> <span class="n">return</span> <span class="o">.</span> <span class="n">makeToken</span> <span class="n">source</span> <span class="n">offset</span> <span class="kt">MarkToken</span> <span class="o">$</span> <span class="kt">T</span><span class="o">.</span><span class="n">singleton</span> <span class="n">c</span>
    <span class="o">|</span> <span class="n">otherwise</span>         <span class="ow">=</span> <span class="n">return</span> <span class="o">.</span> <span class="n">makeToken</span> <span class="n">source</span> <span class="n">offset</span> <span class="kt">UnknownToken</span> <span class="o">$</span> <span class="kt">T</span><span class="o">.</span><span class="n">singleton</span> <span class="n">c</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>This is an augmented separator predicate that also tests for spaces.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nf">isSeparator</span> <span class="ow">::</span> <span class="kt">Char</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
<span class="nf">isSeparator</span> <span class="n">c</span> <span class="ow">=</span> <span class="kt">C</span><span class="o">.</span><span class="n">isSpace</span> <span class="n">c</span> <span class="o">||</span> <span class="kt">C</span><span class="o">.</span><span class="n">isSeparator</span> <span class="n">c</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>This runs <code>takeWhile</code> with the predicate, conses the initial element to the
front, and creates a Token of the given type. Hence <code>Token</code> from <code>takeWhile</code>
-en. Or something.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nf">tokenFromTaken</span> <span class="ow">::</span> <span class="kt">Monad</span> <span class="n">m</span>   
               <span class="ow">=&gt;</span> <span class="kt">FilePath</span>                      <span class="c1">-- ^ tokenSource</span>
               <span class="ow">-&gt;</span> <span class="kt">Integer</span>                       <span class="c1">-- ^ tokenOffset</span>
               <span class="ow">-&gt;</span> <span class="kt">TokenType</span>                     <span class="c1">-- ^ tokenType</span>
               <span class="ow">-&gt;</span> <span class="kt">Char</span>                          <span class="c1">-- ^ Initial character.</span>
               <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">Char</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span>                <span class="c1">-- ^ Predicate for taking the rest of the token.</span>
               <span class="ow">-&gt;</span> <span class="kt">E</span><span class="o">.</span><span class="kt">Iteratee</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Text</span> <span class="n">m</span> <span class="kt">Token</span>
<span class="nf">tokenFromTaken</span> <span class="n">source</span> <span class="n">offset</span> <span class="n">tType</span> <span class="n">initial</span> <span class="n">predicate</span> <span class="ow">=</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>The composed function here attaches the initial character, actualizes
the token string from lazy to strict, and creates the <code>Token</code> from that.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">liftM</span> <span class="p">(</span><span class="n">makeToken</span> <span class="n">source</span> <span class="n">offset</span> <span class="n">tType</span> <span class="o">.</span> <span class="kt">LT</span><span class="o">.</span><span class="n">toStrict</span> <span class="o">.</span> <span class="kt">LT</span><span class="o">.</span><span class="n">cons</span> <span class="n">initial</span><span class="p">)</span>
          <span class="p">(</span><span class="kt">ET</span><span class="o">.</span><span class="n">takeWhile</span> <span class="n">predicate</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>This takes the minimum data necessary to create a token, normalizes the
input text, and creates the <code>Token</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nf">makeToken</span> <span class="ow">::</span> <span class="kt">FilePath</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">TokenType</span> <span class="ow">-&gt;</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Text</span> <span class="ow">-&gt;</span> <span class="kt">Token</span>
<span class="nf">makeToken</span> <span class="n">source</span> <span class="n">offset</span> <span class="n">tType</span> <span class="n">raw</span> <span class="ow">=</span>
    <span class="kt">Token</span> <span class="n">normalized</span> <span class="n">raw</span> <span class="n">rawLength</span> <span class="n">tType</span> <span class="n">source</span> <span class="n">offset</span>
    <span class="kr">where</span>
        <span class="n">normalized</span> <span class="ow">=</span> <span class="n">normalizeToken</span> <span class="n">raw</span>
        <span class="n">rawLength</span>  <span class="ow">=</span> <span class="kt">T</span><span class="o">.</span><span class="n">length</span> <span class="n">raw</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>This takes a raw token <code>Text</code> and returns a normalized version. Currently,
this just lower-cases everything.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nf">normalizeToken</span> <span class="ow">::</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Text</span> <span class="ow">-&gt;</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="nf">normalizeToken</span> <span class="ow">=</span> <span class="kt">T</span><span class="o">.</span><span class="n">map</span> <span class="kt">C</span><span class="o">.</span><span class="n">toLower</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 