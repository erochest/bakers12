<!DOCTYPE html>  <html> <head>   <title>Types.hs</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               Types.hs             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>|
Module      : Text.Bakers12.Tokenizer.Types
License     : Apache 2.0
Maintainer  : erochest@gmail.com
Portability : GHC</p>

<p>This defines the types for the tokenizers. Especially, this defines the
Token and TokenType data types.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kr">module</span> <span class="nn">Text.Bakers12.Tokenizer.Types</span>
    <span class="p">(</span> <span class="kt">Token</span><span class="p">(</span><span class="o">..</span><span class="p">)</span>
    <span class="p">,</span> <span class="kt">TokenType</span><span class="p">(</span><span class="o">..</span><span class="p">)</span>
    <span class="p">,</span> <span class="nf">empty</span>
    <span class="p">,</span> <span class="nf">isReadable</span>
    <span class="p">,</span> <span class="nf">append</span>
    <span class="p">,</span> <span class="nf">concat</span>
    <span class="p">,</span> <span class="nf">splitAt</span>
    <span class="p">)</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.List</span> <span class="k">as</span> <span class="n">L</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Text</span> <span class="k">as</span> <span class="n">T</span>
<span class="kr">import</span>           <span class="nn">Prelude</span> <span class="k">hiding</span> <span class="p">(</span><span class="nf">concat</span><span class="p">,</span> <span class="nf">splitAt</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <ul>
<li>Token Type</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>| This contains data from one token instance.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kr">data</span> <span class="kt">Token</span> <span class="ow">=</span> <span class="kt">Token</span>
    <span class="p">{</span> <span class="n">tokenText</span>   <span class="ow">::</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>         <span class="c1">-- ^ The normalized token text.</span>
    <span class="p">,</span> <span class="n">tokenRaw</span>    <span class="ow">::</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>         <span class="c1">-- ^ The raw token text.</span>
    <span class="p">,</span> <span class="n">tokenLength</span> <span class="ow">::</span> <span class="kt">Int</span>            <span class="c1">-- ^ The length of the raw token.</span>
    <span class="p">,</span> <span class="n">tokenType</span>   <span class="ow">::</span> <span class="kt">TokenType</span>      <span class="c1">-- ^ The type of data contained in the</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>token.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">,</span> <span class="n">tokenSource</span> <span class="ow">::</span> <span class="kt">FilePath</span>       <span class="c1">-- ^ The source (sometimes a file) that</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>the token was found in.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">,</span> <span class="n">tokenOffset</span> <span class="ow">::</span> <span class="kt">Integer</span>        <span class="c1">-- ^ The character offset of the start of</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>the token in the source (zero-indexed).</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">}</span>
    <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Eq</span><span class="p">,</span> <span class="kt">Show</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>| This has the types of information that a token can contain.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kr">data</span> <span class="kt">TokenType</span> <span class="ow">=</span>
      <span class="kt">AlphaToken</span>                    <span class="c1">-- ^ Unicode alphabetic characters.</span>
    <span class="o">|</span> <span class="kt">NumberToken</span>                   <span class="c1">-- ^ Unicode numeric characters.</span>
    <span class="o">|</span> <span class="kt">SeparatorToken</span>                <span class="c1">-- ^ Unicode space or Unicode separator</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>character.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="o">|</span> <span class="kt">PunctuationToken</span>              <span class="c1">-- ^ One Unicode punctuation character.</span>
    <span class="o">|</span> <span class="kt">SymbolToken</span>                   <span class="c1">-- ^ One Unicode symbol character.</span>
    <span class="o">|</span> <span class="kt">MarkToken</span>                     <span class="c1">-- ^ One Unicode mark character.</span>
    <span class="o">|</span> <span class="kt">UnknownToken</span>                  <span class="c1">-- ^ None of the categories above.</span>
    <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Eq</span><span class="p">,</span> <span class="kt">Show</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>| This is an empty token.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nf">empty</span> <span class="ow">::</span> <span class="kt">Token</span>
<span class="nf">empty</span> <span class="ow">=</span> <span class="kt">Token</span> <span class="kt">T</span><span class="o">.</span><span class="n">empty</span> <span class="kt">T</span><span class="o">.</span><span class="n">empty</span> <span class="mi">0</span> <span class="kt">UnknownToken</span> <span class="s">&quot;&quot;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>| This tests whether a token is "readable." I.e., whether its type is
AlphaToken or NumberToken.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nf">isReadable</span> <span class="ow">::</span> <span class="kt">Token</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
<span class="nf">isReadable</span> <span class="n">token</span> <span class="ow">=</span> <span class="n">tType</span> <span class="o">==</span> <span class="kt">AlphaToken</span> <span class="o">||</span> <span class="n">tType</span> <span class="o">==</span> <span class="kt">NumberToken</span>
    <span class="kr">where</span> <span class="n">tType</span> <span class="ow">=</span> <span class="n">tokenType</span> <span class="n">token</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>| This takes two tokens (presumably right next to each other in the input
stream, although this doesn't verify that) and concatenates them by
concatenating their text and raw data and their lengths.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nf">append</span> <span class="ow">::</span> <span class="kt">Token</span> <span class="ow">-&gt;</span> <span class="kt">Token</span> <span class="ow">-&gt;</span> <span class="kt">Token</span>
<span class="nf">append</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span>
    <span class="n">a</span> <span class="p">{</span> <span class="n">tokenText</span>   <span class="ow">=</span> <span class="kt">T</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="n">tokenText</span> <span class="n">a</span><span class="p">)</span> <span class="p">(</span><span class="n">tokenText</span> <span class="n">b</span><span class="p">)</span>
      <span class="p">,</span> <span class="n">tokenRaw</span>    <span class="ow">=</span> <span class="kt">T</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="n">tokenRaw</span> <span class="n">a</span><span class="p">)</span> <span class="p">(</span><span class="n">tokenRaw</span> <span class="n">b</span><span class="p">)</span>
      <span class="p">,</span> <span class="n">tokenLength</span> <span class="ow">=</span> <span class="n">tokenLength</span> <span class="n">a</span> <span class="o">+</span> <span class="n">tokenLength</span> <span class="n">b</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>| This takes a list of tokens and appends them. Like append above, it
assumes that the tokens occur right next to each other.</p>

<p>The implementation of this could use fold, but I thought that using T.concat
and not constructing any intermediate Tokens would be faster.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nf">concat</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">Token</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">Token</span>
<span class="nf">concat</span> <span class="kt">[]</span>       <span class="ow">=</span> <span class="n">empty</span>
<span class="nf">concat</span> <span class="p">[</span><span class="n">t</span><span class="p">]</span>      <span class="ow">=</span> <span class="n">t</span>
<span class="nf">concat</span> <span class="p">[</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">]</span> <span class="ow">=</span> <span class="n">append</span> <span class="n">t1</span> <span class="n">t2</span>
<span class="nf">concat</span> <span class="n">ts</span><span class="o">@</span><span class="p">(</span><span class="n">a</span><span class="kt">:</span><span class="kr">_</span><span class="p">)</span> <span class="ow">=</span>
    <span class="n">a</span> <span class="p">{</span> <span class="n">tokenText</span>   <span class="ow">=</span> <span class="kt">T</span><span class="o">.</span><span class="n">concat</span> <span class="n">texts</span>
      <span class="p">,</span> <span class="n">tokenRaw</span>    <span class="ow">=</span> <span class="kt">T</span><span class="o">.</span><span class="n">concat</span> <span class="n">raws</span>
      <span class="p">,</span> <span class="n">tokenLength</span> <span class="ow">=</span> <span class="n">sum</span> <span class="n">lengths</span>
      <span class="p">}</span>
    <span class="kr">where</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Another small optimization, so we don't have to walk the input list
more than once. If these operations can be fused, that would be
best, but even just walking the list twice is better than walking it
three times. (Best would be to write unzipWith3 or something, which
would insure that the list was only walked twice. Someday.)</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">(</span><span class="n">texts</span><span class="p">,</span> <span class="n">raws</span><span class="p">,</span> <span class="n">lengths</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">L</span><span class="o">.</span><span class="n">unzip3</span> <span class="o">.</span> <span class="n">map</span> <span class="n">getFields</span> <span class="o">$</span> <span class="n">ts</span>
        <span class="n">getFields</span> <span class="n">t</span> <span class="ow">=</span> <span class="p">(</span><span class="n">tokenText</span> <span class="n">t</span><span class="p">,</span> <span class="n">tokenRaw</span> <span class="n">t</span><span class="p">,</span> <span class="n">tokenLength</span> <span class="n">t</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>| This splits a token on position N in the tokenText. This copies the raw
token, unchanged, into each of the resulting tokens. However, the offset of
the second token is moved up and the length of the tokens reflects the
length of the split token texts.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nf">splitAt</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Token</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">Token</span><span class="p">,</span> <span class="kt">Token</span><span class="p">)</span>
<span class="nf">splitAt</span> <span class="n">n</span> <span class="n">token</span> <span class="ow">=</span> <span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span>
    <span class="kr">where</span> <span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">T</span><span class="o">.</span><span class="n">splitAt</span> <span class="n">n</span> <span class="o">$</span> <span class="n">tokenText</span> <span class="n">token</span>
          <span class="n">t1</span> <span class="ow">=</span> <span class="n">token</span> <span class="p">{</span> <span class="n">tokenText</span>   <span class="ow">=</span> <span class="n">text1</span>
                     <span class="p">,</span> <span class="n">tokenLength</span> <span class="ow">=</span> <span class="kt">T</span><span class="o">.</span><span class="n">length</span> <span class="n">text1</span>
                     <span class="p">}</span>
          <span class="n">t2</span> <span class="ow">=</span> <span class="n">token</span> <span class="p">{</span> <span class="n">tokenText</span>   <span class="ow">=</span> <span class="n">text2</span>
                     <span class="p">,</span> <span class="n">tokenOffset</span> <span class="ow">=</span> <span class="n">tokenOffset</span> <span class="n">token</span> <span class="o">+</span> <span class="n">fromIntegral</span> <span class="p">(</span><span class="kt">T</span><span class="o">.</span><span class="n">length</span> <span class="n">text1</span><span class="p">)</span>
                     <span class="p">,</span> <span class="n">tokenLength</span> <span class="ow">=</span> <span class="kt">T</span><span class="o">.</span><span class="n">length</span> <span class="n">text2</span>
                     <span class="p">}</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 